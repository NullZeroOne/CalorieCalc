<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scoundrel ‚Äî Single-Page Web App</title>
<style>
  :root{
    --bg:#0f1220;
    --panel:#171a2b;
    --ink:#e9ecff;
    --muted:#b7bfef;
    --accent:#8fd3ff;
    --danger:#ff7a7a;
    --ok:#79e58a;
    --card:#222642;
    --btn:#2a2f51;
    --btn-hover:#36407a;
    --disabled:#404565;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, sans-serif;
    background:linear-gradient(180deg, #0a0d1a, var(--bg));
    color:var(--ink);
    min-height:100vh;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:24px;
  }
  .app{width:min(100%,980px);background:var(--panel);border:1px solid #2a2f51;
    border-radius:16px;padding:18px;box-shadow:0 20px 50px rgba(0,0,0,.35);}
  header{display:flex;flex-wrap:wrap;align-items:center;gap:12px 16px;justify-content:space-between;margin-bottom:8px;}
  .title{font-weight:700;}
  .hud{display:flex;gap:18px;flex-wrap:wrap;align-items:center;}
  .stat{background:var(--card);padding:8px 12px;border-radius:10px;border:1px solid #2c3155;font-weight:600;}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 14px;}
  button{cursor:pointer;background:var(--btn);color:var(--ink);border:1px solid #3a3f6d;border-radius:10px;padding:10px 14px;font-weight:600;}
  button:hover{background:var(--btn-hover);} button:disabled{opacity:.55;cursor:not-allowed;background:var(--disabled);}
  .room{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;}
  .card{background:var(--card);border:1px solid #2e3361;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:8px;min-height:170px;}
  .face{display:flex;align-items:center;justify-content:space-between;gap:10px;background:#1c2142;border:1px solid #353c7a;border-radius:10px;padding:8px 10px;font-weight:700;}
  .suit{font-size:20px;} .red{color:#ff9aba;} .blk{color:#9ec7ff;}
  .kind{font-size:12px;color:var(--muted);}
  .actions{display:flex;flex-direction:column;gap:8px;margin-top:auto;}
  .log{margin-top:14px;background:var(--card);border:1px solid #2c3155;border-radius:12px;padding:10px 12px;max-height:200px;overflow:auto;font-size:14px;}
  .log p{margin:6px 0;color:#cbd2ff;} .ok{color:var(--ok);} .bad{color:var(--danger);}
  .footer{display:flex;gap:10px;justify-content:flex-end;margin-top:10px;}
  .pill{display:inline-flex;align-items:center;gap:8px;background:#1b2040;padding:8px 10px;border-radius:999px;border:1px solid #313a74;}
  .weaponStack{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
  .stackCard{background:#1b2040;border:1px solid #313a74;border-radius:8px;padding:6px 8px;font-size:13px;}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,7,15,.7);}
  .modal{background:var(--panel);padding:20px;border-radius:14px;width:min(92vw,520px);border:1px solid #2a2f51;}
  .modal h2{margin:0 0 8px 0;} .modal p{color:var(--muted);} .modal .actions{flex-direction:row;margin-top:12px;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">üó°Ô∏è Scoundrel</div>
    <div class="hud">
      <div class="stat">HP: <span id="hp">20</span></div>
      <div class="stat">Deck: <span id="deckCount">0</span></div>
      <div class="stat">Discard: <span id="discardCount">0</span></div>
      <div class="stat">Moves: <span id="moves">0</span>/3</div>
    </div>
  </header>
  <div class="row">
    <button id="runBtn">Run</button>
    <div class="pill"><strong>Weapon:</strong>&nbsp;<span id="weaponLabel">None</span>
      <div class="weaponStack" id="weaponStack"></div>
    </div>
  </div>
  <section class="room" id="room"></section>
  <section class="log" id="log"></section>
  <div class="footer"><button id="restartBtn" style="display:none">Play Again</button></div>
</div>
<div class="overlay" id="overlay">
  <div class="modal"><h2 id="modalTitle"></h2><p id="modalMsg"></p>
    <div class="actions"><button id="modalRestart">Play Again</button></div>
  </div>
</div>

<script>
(() => {
  const SUITS=["‚ô•","‚ô¶","‚ô£","‚ô†"],RANKS=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const val=r=>r==="A"?1:r==="J"?11:r==="Q"?12:r==="K"?13:parseInt(r);
  const isRed=s=>s==="‚ô•"||s==="‚ô¶"; const kind=c=>c.suit==="‚ô¶"?"weapon":c.suit==="‚ô•"?"potion":"monster";
  const fmt=c=>c.rank+c.suit;
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
  let state;
  function newGame(){
    const deck=[]; for(const s of SUITS){for(const r of RANKS){if(isRed(s)&&["A","J","Q","K"].includes(r))continue;deck.push({rank:r,suit:s,value:val(r),type:null});}}
    deck.forEach(c=>c.type=kind(c)); shuffle(deck);
    state={hp:20,deck,discard:[],room:[],moves:0,potionDrunk:false,weapon:[],ranLast:false,over:false};
    drawToRoom(4); render(); log("New game started. First room drawn.");
  }
  function drawToRoom(n){while(state.deck.length&&state.room.length<4&&n>0){state.room.push(state.deck.shift());n--;}}
  function log(m,cls=""){const p=document.createElement("p");if(cls)p.className=cls;p.textContent=m;document.getElementById("log").appendChild(p);}
  function updHUD(){hp.textContent=state.hp;deckCount.textContent=state.deck.length;discardCount.textContent=state.discard.length;moves.textContent=state.moves;}
  function canUseW(mon){if(!state.weapon.length)return false;if(state.weapon.length===1)return true;return mon.value<state.weapon[state.weapon.length-1].value;}
  function baseVal(){return state.weapon.length?state.weapon[0].value:0;}
  function actMonster(idx,armed){const c=state.room[idx];if(armed&&!canUseW(c))return;const dmg=armed?Math.max(c.value-baseVal(),0):c.value;state.hp-=dmg;if(armed)state.weapon.push(c);else state.discard.push(c);state.room.splice(idx,1);state.moves++;log(`${armed?"Weapon":"Unarmed"} vs ${fmt(c)}: took ${dmg}. HP ${state.hp}`,dmg?"bad":"ok");after();}
  function equip(idx){const c=state.room[idx];if(state.weapon.length)state.discard.push(...state.weapon);state.weapon=[c];state.room.splice(idx,1);state.moves++;log(`Equipped ${fmt(c)}.`, "ok");after();}
  function potion(idx){const c=state.room[idx];if(!state.potionDrunk){state.hp+=c.value;state.potionDrunk=true;log(`Drank ${fmt(c)}: +${c.value} HP ${state.hp}`,"ok");}else{log(`Discarded ${fmt(c)} (already drank)`);}state.discard.push(c);state.room.splice(idx,1);state.moves++;after();}
  function run(){if(state.moves>=3){next();return;}if(state.room.length!==4||state.ranLast)return;state.deck.push(...state.room);state.room=[];drawToRoom(4);state.potionDrunk=false;state.moves=0;state.ranLast=true;log("Ran away; drew new room.");render();}
  function next(){if(state.moves<3)return;if(!state.deck.length){log("No cards left.");render();return;}state.moves=0;state.potionDrunk=false;state.ranLast=false;drawToRoom(3);log("Next turn, refilled.");render();}
  function after(){updHUD();if(state.hp<=0){over("Defeated","0 HP. Try again.");return;}if(!state.deck.length&&!state.room.length){over("Victory!","You cleared the deck.");return;}render();}
  function over(t,m){state.over=true;modalTitle.textContent=t;modalMsg.textContent=m;overlay.style.display="flex";restartBtn.style.display="inline-block";}
  function render(){updHUD();room.innerHTML="";runBtn.textContent=state.moves>=3?"Next turn":"Run";runBtn.disabled=state.moves<3?!(state.room.length===4&&!state.ranLast):(!state.deck.length);
    const hide=state.moves>=3&&state.deck.length>0&&state.room.length===1;
    state.room.forEach((c,i)=>{const d=document.createElement("div");d.className="card";d.innerHTML=`<div class="face"><span>${c.rank}</span><span class="suit ${isRed(c.suit)?"red":"blk"}">${c.suit}</span></div><div class="kind">${c.type}</div>`;const a=document.createElement("div");a.className="actions";
      if(!hide){if(c.type==="monster"){let u=document.createElement("button");u.textContent=`Attack unarmed (take ${c.value})`;u.onclick=()=>actMonster(i,false);a.appendChild(u);
          if(canUseW(c)){let w=document.createElement("button");w.textContent=`Attack weapon (take ${Math.max(c.value-baseVal(),0)})`;w.onclick=()=>actMonster(i,true);a.appendChild(w);}}
        else if(c.type==="weapon"){let b=document.createElement("button");b.textContent=`Equip weapon (${c.value})`;b.onclick=()=>equip(i);a.appendChild(b);}
        else{let b=document.createElement("button");b.textContent=state.potionDrunk?"Discard potion":`Drink potion (+${c.value})`;b.onclick=()=>potion(i);a.appendChild(b);}}
      else{a.innerHTML="<div class='kind'>Will carry over</div>";}
      d.appendChild(a);room.appendChild(d);});
    const wl=document.getElementById("weaponLabel"),ws=document.getElementById("weaponStack");ws.innerHTML="";if(!state.weapon.length){wl.textContent="None";}else{wl.textContent=`${fmt(state.weapon[0])} (value ${state.weapon[0].value})`;for(let j=1;j<state.weapon.length;j++){const sc=document.createElement("span");sc.className="stackCard";sc.textContent=fmt(state.weapon[j]);ws.appendChild(sc);}}
  }
  runBtn.onclick=()=>{if(state.moves>=3)next();else run();};restartBtn.onclick=()=>{overlay.style.display="none";newGame();};modalRestart.onclick=()=>{overlay.style.display="none";newGame();};
  newGame();
})();
</script>
</body>
</html>
