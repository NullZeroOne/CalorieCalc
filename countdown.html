
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Countdown to Jan 20, 2029 Noon EST</title>
  <style>
    body {
      font-family: monospace;
      font-size: 2em;
      text-align: center;
      margin-top: 8vh;
    }
    #countdown {
      min-width: 30em;
      display: inline-block;
    }
    #message {
      font-size: 0.8em;
      color: #444;
      margin-top: 1em;
    }
    #progress-container {
      width: 80%;
      margin: 30px auto 10px auto;
      height: 30px;
      background: #eee;
      border: 1px solid #ccc;
      border-radius: 5px;
      overflow: hidden;
    }
    #progress-bar {
      height: 100%;
      background: #4caf50;
      width: 0%;
    }
    #percent-display {
      margin-top: 10px;
      font-size: 1em;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="countdown">Loading...</div>
  <div id="message"></div>

  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>
  <div id="percent-display"></div>

  <script>
    function pluralizeFixed(value, unit) {
      const padded = value.toString().padStart(2, " ");
      const word = unit + (value === 1 ? " " : "s");
      return padded + " " + word;
    }

    function tryParseDateParam() {
      const params = new URLSearchParams(window.location.search);
      const dateStr = params.get("date");
      const message = document.getElementById("message");

      if (!dateStr) return { date: new Date(), message: "" };

      try {
        if (!/^\d{12}$/.test(dateStr)) throw new Error("Invalid format. Expected YYYYMMDDHHMM.");

        const year = parseInt(dateStr.slice(0, 4));
        const month = parseInt(dateStr.slice(4, 6)) - 1;
        const day = parseInt(dateStr.slice(6, 8));
        const hour = parseInt(dateStr.slice(8, 10));
        const minute = parseInt(dateStr.slice(10, 12));

        const localDate = new Date(year, month, day, hour, minute);
        const estDate = new Date(localDate.toLocaleString("en-US", { timeZone: "America/New_York" }));

        message.textContent = "Using local time " + localDate.toString() +
          " (" + estDate.toLocaleString("en-US", { timeZone: "America/New_York", timeZoneName: "short" }) + ")";

        return { date: localDate, message: "" };
      } catch (err) {
        return {
          date: new Date(),
          message: "Error parsing date parameter '" + dateStr + "': " + err.message
        };
      }
    }

    function renderCountdown(staticNow) {
      const endEST = new Date("2029-01-20T17:00:00Z");
      const startEST = new Date("2025-01-20T17:00:00Z");
      const totalMs = endEST - startEST;
      const elapsedMs = staticNow.getTime() - startEST.getTime();
      const percentElapsed = Math.min(100, Math.max(0, (elapsedMs / totalMs) * 100));

      let remaining = endEST.getTime() - staticNow.getTime();
      if (remaining < 0) remaining = 0;

      const targetDate = new Date(endEST);
      const nowDate = new Date(staticNow);

      let years = targetDate.getUTCFullYear() - nowDate.getUTCFullYear();
      let months = targetDate.getUTCMonth() - nowDate.getUTCMonth();
      let days = targetDate.getUTCDate() - nowDate.getUTCDate();
      let hrs = targetDate.getUTCHours() - nowDate.getUTCHours();
      let mins = targetDate.getUTCMinutes() - nowDate.getUTCMinutes();
      let secs = targetDate.getUTCSeconds() - nowDate.getUTCSeconds();

      if (secs < 0) { secs += 60; mins--; }
      if (mins < 0) { mins += 60; hrs--; }
      if (hrs < 0) { hrs += 24; days--; }
      if (days < 0) {
        const prevMonth = new Date(nowDate.getUTCFullYear(), nowDate.getUTCMonth(), 0);
        days += prevMonth.getUTCDate();
        months--;
      }
      if (months < 0) { months += 12; years--; }

      const countdownText = (remaining === 0)
        ? " 0 years,  00 months,  00 days,  00 hours,  00 minutes,  00 seconds"
        : pluralizeFixed(years, "year") + ",  " +
          pluralizeFixed(months, "month") + ",  " +
          pluralizeFixed(days, "day") + ",  " +
          pluralizeFixed(hrs, "hour") + ",  " +
          pluralizeFixed(mins, "minute") + ",  " +
          pluralizeFixed(secs, "second");

      document.getElementById("countdown").textContent = countdownText;
      document.getElementById("progress-bar").style.width = percentElapsed.toFixed(2) + "%";
      document.getElementById("percent-display").textContent = percentElapsed.toFixed(2) + "%";
    }

    const result = tryParseDateParam();
    if (result.message) {
      document.getElementById("message").textContent = result.message;
    }
    renderCountdown(result.date);
  </script>
</body>
</html>
