<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game of Life Product Requirements Document</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 2em; }
    h1, h2, h3 { color: #2f6feb; }
    code { background: #f4f4f4; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Conway’s Game of Life — Product Requirements Document (PRD)</h1>

  <h2>Overview</h2>
  <p>This is a browser-based implementation of Conway’s Game of Life with advanced visualization and control features, including Rainbow mode, Aging with PopRebal, directional/quarter fills, and undo/redo history.</p>

  <h2>Defaults</h2>
  <ul>
    <li>Default block size: <strong>15 px</strong></li>
    <li>Default history buffer size: <strong>20</strong></li>
    <li>Default fill percentage: <strong>10%</strong></li>
    <li>Toroidal topology: <strong>enabled</strong></li>
    <li>Rainbow mode: <strong>disabled</strong></li>
    <li>Trends: <strong>disabled</strong></li>
    <li>Aging: <strong>disabled</strong></li>
    <li>PopRebal: <strong>disabled</strong></li>
  </ul>

  <h2>Key Features</h2>
  <ul>
    <li><strong>Play / Pause / Step</strong> controls with undo/redo history.</li>
    <li><strong>History snapshots:</strong> manual edits (drawing/filling) now always push snapshots. This fixes the previous bug where stepping back after a draw returned to an empty board.</li>
    <li><strong>Rainbow Mode:</strong> cells born from exactly 3 neighbors inherit the average color of those neighbors. Colors are always stored. Rainbow and Aging can be enabled together.</li>
    <li><strong>Aging:</strong> cells alive across the full history die and respawn outward. Respawn count varies based on Birth Rate and PopRebal rules.</li>
    <li><strong>PopRebal:</strong> requires Aging. Adjusts respawns based on live population vs. fill% ± threshold.</li>
    <li><strong>Fill Feature:</strong> uses a <strong>3×3 grid of arrow buttons</strong>:
      <ul>
        <li>↖️ top-left quarter</li>
        <li>⬆️ top half</li>
        <li>↗️ top-right quarter</li>
        <li>⬅️ left half</li>
        <li>⏺️ entire board</li>
        <li>➡️ right half</li>
        <li>↙️ bottom-left quarter</li>
        <li>⬇️ bottom half</li>
        <li>↘️ bottom-right quarter</li>
      </ul>
    </li>
    <li><strong>Fill Behavior:</strong> activating cells by percentage; never clears existing live cells.</li>
    <li><strong>Clear:</strong> clears both the board and the history buffer.</li>
    <li><strong>Stored Colors Always Used:</strong> The Colorize B/W option has been removed. When Rainbow is off, stored per-cell colors are still used for display instead of plain black.</li>
    <li><strong>Trends Visualization:</strong> multi-stop gradient (white → blue → teal → green → yellow → red) based on activity fraction. Includes an on-canvas legend.</li>
    <li><strong>FPS Indicator:</strong> shows turns per second while running, persists when paused, unaffected by undo/redo.</li>
    <li><strong>Keyboard Shortcuts:</strong> space toggles play/pause; ← steps back; → steps forward.</li>
  </ul>

  <h2>Fill Color Picker</h2>
  <p>Includes a color picker button (default blue). The selected color is used for fills, manual drawing, and non-rainbow births/aging respawns.</p>

  <h2>Status Panel</h2>
  <ul>
    <li>Generation count</li>
    <li>Live cell count</li>
    <li>Grid dimensions</li>
    <li>Topology (Toroidal/Bounded)</li>
    <li>Live %</li>
    <li>FPS indicator</li>
  </ul>

  <h2>Known Fixes</h2>
  <p><strong>History bug fixed:</strong> Step Back after drawing now correctly returns to the drawn shape (manual edits push snapshots).</p>
</body>
</html>